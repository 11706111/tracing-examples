# Tracing on Istio

SignalFx has an adapter to the Istio Mixer that can send trace spans. These
trace spans are automatically generated by the Istio proxy sidecar container and
are sent to the Istio telemetry server, where our adapter receives them and
sends them to SignalFx.

> **Note:** although Istio 1.0.0 has a SignalFx mixer adapter, that version does
> not include support for traces. The next release of Istio, expected around the
> end of August 2018, will include that support. In the meantime, if you intend
> to use Istio to report traces to SignalFx, please use a recent nightly build
> of Istio. Istio publishes nightly built Docker images for the mixer under
> `docker.io/istionightly/mixer:nightly-master`.
>
> Until the next release of Istio, you'll find the documentation about SignalFx
> mixer adapter's support for tracing [in its unreleased form
> here](https://github.com/istio/istio/blob/master/mixer/adapter/signalfx/config/adapter.signalfx.config.pb.html#L129).
> Note that default settings should suffice as tracing support is enabled by
> default.

Istio gives you considerable flexibility on which tags to include on spans. The
tag values are derived from [Istio attribute
variables](https://istio.io/docs/reference/config/policy-and-telemetry/attribute-vocabulary/)
which allow you to pull out almost every piece of metadata about a
request/response cycle except for the request/response body itself.

To enable SignalFx tracing for Istio running on Kubernetes, modify the file
[signalfx.yaml](./signalfx.yaml) to have your SignalFx organization's access
token, and then apply the K8s resources found in that file.

```
$ kubectl apply -f signalfx.yaml
```

This will add the adapter config along with a rule to send trace spans of a
certain format to the `signalfx` adapter.  See [the SignalFx adapter Istio
docs](https://istio.io/docs/reference/config/policy-and-telemetry/adapters/signalfx/)
for more details on how to configure the adapter and what form the trace spans
must be in.

You should see traces for all traffic that is goes through the service mesh,
including calls from your applications to Istio mixer and pilot services.

# Sampling

By default, every span that is generated in Istio will be forwarded to SignalFx,
but this may be prohibitive both in terms of cost and load on the telemetry
server.  You can set the sampling probability with the
`tracing_sample_probability` config option to the adapter.  See the adapter docs
for more details.

# References

- [SignalFx Istio adapter docs](https://istio.io/docs/reference/config/policy-and-telemetry/adapters/signalfx/)
- [Istio attribute variables](https://istio.io/docs/reference/config/policy-and-telemetry/attribute-vocabulary/)
